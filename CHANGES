**************************
**************************
version 3.03

February 14 2008

The National Library of Finland
Ere Maijala
http://www.nationallibrary.fi/
ere.maijala at helsinki.fi

- Fixed a one time memory leak in TUMApplication.
- Fixed an invalid file write attempt when converting record in
  a memory buffer.


**************************
**************************
version 3.02

February 14 2008

The National Library of Finland
Ere Maijala
http://www.nationallibrary.fi/
ere.maijala at helsinki.fi

- Updated the accompanying PCRE library to version 7.6.
- Updated PCRE build instructions to disable pcrecpp (not needed).
- Fixed USEMARCON program build to link with libpcre instead of
  libpcrecpp.
- Fixed a possible bug in trimming of rule lines and removal
  of CR at end of line.


**************************
**************************
version 3.01

January 28 2008

The National Library of Finland
Ere Maijala
http://www.nationallibrary.fi/
ere.maijala at helsinki.fi

- Fixed global conditions.
- Fixed RegReplaceTable.
- Added check for unbalanced parenthesis to conditions.
- Added 'f' option for RegReplaceTable to only do the first
  matching replace.


**************************
**************************
version 3.00

January 17 2008

The National Library of Finland
Ere Maijala
http://www.nationallibrary.fi/
ere.maijala at helsinki.fi

- Cleaned up the interface ("API") to USEMARCON.
- Cleaned up file name string handling.
- Cleaned up header file dependencies.
- Added duplicate field and subfield processing options.
- Fixed concatenation of a complete field with multiple subfields
  to a single subfield.
- Fixed peeking of output record contents (% operator) in a rule that
  creates a temporary input field.
- Added possibility to do RegFind in string given as a parameter.
- Better UTF-8 support using utf8proc library.
- Added possibility to use simple macros in the rule file.
- Added RegReplaceTable() function that can be used to replace a list
  of strings with a short piece of code.
- Added possibility to split a line to multiple lines using \ in the
  of the line.
- Occurrence parameter in NextSub() and PreviousSub() is now optional.
- Added MoveBefore and MoveAfter to manipulate subfield positions in
  a field.
- Added ExistsIn(), NextSubIn() and PreviousSubIn() to check for
  subfields in S or other string.
- Fixed rule parser to not get confused over pipe characters embedded
  in strings.
- Fixed regular expressions handling to handle escaped characters
  properly inside square brackets.
- Added occurrence specifier "newest" that can be used to target the
  last occurrence of the tag.
- Switched regular expressions support to use PCRE for added features.
- Added RegFindPos and RegFindNum.
- Added left-recursive If statement handling. A branch is no
  more evaluated unless it matches the condition.
- Added execution blocks for conditional processing (denoted by curly
  brackets {}).
- Added While loops.
- Added For loops.
- Combined the documentation to a single document.
- Added record number to logged error and warning messages.
- Conversion will now fail if the specified ini file cannot be opened.
- Added possibility to define minimum version that can be used for the
  conversion. USEMARCON 3.00 has rule version 300. See #define in the
  manual for more information.
- Added possibility to use "global" conditions for a group of rules.
  See #if in manual for more information.

**************************
**************************
version 2.01

August 14 2007

The National Library of Finland
Ere Maijala
http://www.nationallibrary.fi/
ere.maijala at helsinki.fi

- Fixed initialization of CD's to reset output flag. Fixes spurious
  errors when trying to access input record.
- Improved rule debug mode output and made all output go to console.

**************************
**************************
version 2.00

August 2 2007

The National Library of Finland
Ere Maijala
http://www.nationallibrary.fi/
ere.maijala at helsinki.fi

- Renewed the core scanner and parser. Parser is now built with bison
  and converted to C++ by a perl script. Scanner is built with flex in
  C++ mode. Building of them is currently not part of the regular build
  process.
- Fixed conversion of full fields in field order mode.
- Added NextSub($x, '>=1') and PreviousSub($x, '>=1') to handle subfield
  occurrences better.
- Added option to convert all subfield codes to lower case
  (ConvertSubfieldCodesToLowercase=TRUE in [DEFAULT_STATES] section).
- Added possibility to use nonbreaking conditionals (just leave 'Then'
  out from an 'If' clause.
- Added possibility to make USEMARCON always create a new field:
  500 | 500(New) | S
- Fixed concatenation when converting a full field.
- Fixed using wildcards in subfield codes in field order mode.
- Added possibility to peek at a converted (output) field by prepending
  the tag code with % (e.g. If (%008/0-5/ = '123456') Then S).
- Added regexp support for \s, \S, \w, \W, \d, \D, \b and \B
  (escape \ in actual rules (e.g. \\s).
- Fixed sorting of temporary fields to not lose data when using field
  order.
- Fixed wildcard handling when converting complete fields.
- Cleaned up a lot of code and got rid of the huge temporary buffers in
  ErrorHandler and other static buffers. Record or field size is no
  more limited.
- Initial support for MARCXML and MarcXchange records (see documentation
  for more information).
- Improved rule syntax error reporting to include the full rule and line
  number.
- Added possibility to use wildcards (?) with Exists().
- Empty indicators no longer cause warnings but are written out as is.
- Added new function InTable('string', 'filename') that can be used to
  check if a value exists in a table file.
  e.g. If (InTable(S, 'table.tbl') Then S; Table('table.tbl')

**************************
**************************
version 1.81

November 10 2006

The National Library of Finland
Ere Maijala
http://www.kansalliskirjasto.fi/
ere.maijala at helsinki.fi

- Added possibility to convert incoming records from MARC-8 to UTF-8

**************************
**************************
version 1.80

September 27 2006

The National Library of Finland
Ere Maijala
http://www.kansalliskirjasto.fi/
ere.maijala at helsinki.fi

- Updated documentation for new features and revised parts of the old docs.
- Separated interactive mode from file/buffer mode. Now files are used if
  buffers are not specified regardless of the mode. Interactive mode
  controls only whether USEMARCON outputs anything on the console.
- Added possibility to copy the input to output as the default action in
  translation tables. This can be accomplished with a magic token COPY in
  #DEFAULT declaration:

  #DEFAULT | COPY

- Added possibility to use question mark as a wildcard in rules. A question
  mark can replace any single character in field code or subfield code. For
  example the following rules would convert all fields as is (it is assumed
  that 00? are control fields, thus no indicators or subfield codes):

  00? | 00? | S
  ???I1 | ???I1 | S
  ???I2 | ???I2 | S
  ???$? | ???$? | S

- Fixed UTF-8 handling. Now it should finally actually work correctly, but
  it's still a bit limited in that it cannot handle all non-spacing
  characters correctly. Now the functions work on complete glypheme clusters
  (=perceived characters) in the supported ranges.

- Bulletproofed several functions to cope better with broken fields.

- Removed dangerous static declarations from the scanner. It's no more
  directly recreatable from analyse.l, pending rewrite with better
  techniques.

**************************
**************************
version 1.71

29th March 2006

The National Library of Finland
Ere Maijala
http://www.lib.helsinki.fi/
ere.maijala at helsinki.fi

- Fixed UTF-8 mode to work correctly with 3+ byte entities

**************************
**************************
version 1.70

2nd February 2006

The National Library of Finland
Ere Maijala
http://www.lib.helsinki.fi/
ere.maijala at helsinki.fi

- Added support to peeking at the previous contents of the destination field
  using variable D (requires of course that there is already data in the
  destination field). This allows for example comparisons between the old
  and new value and concatenation of old value to the new one.
- Added experimental support for simple regular expressions. Three new
  functions are provided:
  RegFind('expression') returns >= 0 if the expression was found.
  RegMatch(index) returns matched parts by index (0-9).
  RegReplace('expression', 'expression') replaces expression by another.
  \1 \2 etc. can be used to reference the matched parts. Thoroughly untested.
- Added possibility to do the conversion in field order instead of the classic
  rule order. In this new mode the record is processed field by field and all
  matching rules are applied. Enabled by setting ConvertInFieldOrder=TRUE in
  section DEFAULT_STATES of the ini file.
- Added possibility to specify the absolute field or subfield index in input
  or output CD (for example rule "245(1)$a | 240(2)$a | S" would copy $a from
  first 245 to the second 240 in the destination.
- Added possibility to use "If Then Translation Else Condition" and
  "If Then Condition". This allows more complicated conditional rules.
- Fixed a crash if the destination record doesn't contain any fields.
- Fixed a hang when UTF-8 mode was active and To command was used.
- Fixed a problem where transcoding a string with Table command would return
  only the default value and not the other transcoded parts of the string.


**************************
**************************
version 1.60

14th October 2005

The National Library of Finland
Ere Maijala
http://www.lib.helsinki.fi/
ere.maijala at helsinki.fi

- Implemented UTF-8 support for Len, From, To, Between and /.../ operators.
  Enabled by setting UTF8Mode=TRUE in section DEFAULT_STATES of the ini file.
- Fixed a possible memory overwrite error in
  TTransFile::Transcode. Patch by DanX, Talis.
- Fixed a possible memory allocation error in
  TEvaluateRule::Between. Patch by DanX, Talis.
- Fixed an error where indicators for a variable width field were not
  written to the output file if the conversion rules didn't create them
  correctly.
- Optimized the search for a specific field so that it would be faster to
  apply rules for non-existing fields or check if a field exists.
- Implemented a simple memory pooling to optimize memory allocations
- Implemented a simple string class to optimize memory allocations and
  avoid frequent allocations of short strings
- Removed the line length limit (256 characters) of rule and table files
- Fixed a crash when the input data contained an empty variable length field

**************************
**************************
version 1.51

5th January 2005

Helsinki University Library, the National Library of Finland
Ere Maijala
http://www.lib.helsinki.fi/
ere.maijala at helsinki.fi

- added a directive UpdateOrdinalNumber to control if the
  OrdinalNumber in the ini file is updated. It's no longer
  updated by default as the update can cause problems if
  multiple conversions are done simultaneously.

**************************
**************************
version 1.50

7th December 2004

Helsinki University Library, the National Library of Finland
Ere Maijala
http://www.lib.helsinki.fi/
ere.maijala at helsinki.fi

- added some fairly simple Autoconf/Automake magic to ease
  building on different platforms
- fixed a memory leak from precedes and follows operations
- fixed a read of uninitialized memory error
- fixed a potential memory overwrite error from rule handling
- fixed a memory leak from ReplaceOcc operation
- fixed a memory leak from Len operation
- optimized the code a bit, now the uni2uk conversion is more
  than 20% faster than before
- added build command for Microsoft Visual C++ Toolkit 2003

**************************
**************************
version 1.44

24th August 2004

ATP Library Systems Ltd, Finland
http://www.atp.fi
mailto:usemarcon@atp.fi

- a malformed field with no subfields doesn't cause a crash
  anymore

**************************
**************************
version 1.43

28th July 2004

ATP Library Systems Ltd, Finland
http://www.atp.fi
mailto:usemarcon@atp.fi

- fixed a bug which caused a crash or a converted record to
  be reconverted when running in non-interactive mode

**************************
**************************
version 1.42

15th June 2004

ATP Library Systems Ltd, Finland
http://www.atp.fi
mailto:usemarcon@atp.fi

- added the possibility to disable character conversion
- corrected a bug where the non-strict Replace command on a string
  with only spaces crashed the program

**************************
**************************
version 1.41

15th April 2004

ATP Library Systems Ltd, Finland
http://www.atp.fi
mailto:usemarcon@atp.fi

- fixed a crash when a control field containing two characters was
  treated as a data field (thanks to Christopher Dunavant from
  VTLS for reporting the problem)
- fixed error messages related to the above crash
- added command line option -v for verbose mode
- moved the startup banner and usage text away from the library
- unified the way USEMARCON is written
- created MS Visual C++ .NET 2003 project files

**************************
**************************
version 1.4

29th August 2003

ATP Library Systems Ltd, Finland
http://www.atp.fi
mailto:usemarcon@atp.fi

- fixed situations where the ini file was left open if an error was encountered
- fixed the file handling to only require input and output files
- moved the error messages into a header file to avoid the need to locate
  and load them at startup



**************************
**************************
version 1.3

8th July 2003

ATP Library Systems Ltd, Finland
http://www.atp.fi
mailto:usemarcon@atp.fi

We have made some major modifications, fixes and restructuring to
make USEMARCON more suitable for integration in other software,
our main targets being on-the-fly conversions in Z39.50 clients and
multithreaded Z39.50 servers. There are too many changes to list
them all here, but this document outlines the most important ones.


Major Changes
-------------

* Merged Windows and Linux versions

Windows and Linux versions have been merged into the same source.
The current source should be easily adaptable to other systems too.
The ini file handling has been rewritten to be cross platform code. This
includes updating the ini file (the ordinal number), which now works in
Linux too.


* Elimination of global and static data

The scanner and parser have been regenerated using flex++/bison++
(Win32 port available at http://http://www.kohsuke.org/flex++bison++/)
to create C++ classes and avoid global non-reentrant code. Most code
had to be moved from the parser (Analyse.y) to a child class
(TEvaluateRule in a new header file lien_not.h). The error
handler (TError) is now a member of TUMApplication and it is used by
other classes also. Global temporary buffers have been incorporated
into the error handler (this is a workaround to avoid allocating them
in dozens of places).


* Better handling of on-the-fly conversions

Input and output files are no longer required if the data is provided
in a buffer. File names in .ini files can be declared without paths.
In that case it is assumed that they reside in the same directory as
the .ini file itself. Error log is not created if the file name is
empty.


* Elimination of all known memory leaks

All detected memory leaks have been fixed.


* Command line enhancements

Input and output files can now be specified on the command line
overriding the ini file settings. This makes it possible to, for example,
run conversion for a batch of files.


* A bunch of miscellaneous bug fixes

During the modification and testing phases, multiple bugs from minor
to severe (crash-producing) ones were discovered and fixed.


* Non-functional code restructuring for better readability

Most source files have been restructured to fix the different
indentation errors and styles. Some ugly things will remain, but the
overall readability has been improved.
